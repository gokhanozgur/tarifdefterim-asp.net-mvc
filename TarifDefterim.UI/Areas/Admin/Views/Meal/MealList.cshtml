
@{
    ViewBag.Title = "MealList";
    Layout = "~/Areas/Admin/Views/Shared/_panelLayout.cshtml";
}


@model List<TarifDefterim.Model.Option.Meal>


@section style{

    <link href="~/Areas/Admin/Content/css/datatables.min.css" rel="stylesheet" />
    <link href="~/Areas/Admin/Content/css/datatables.bootstrap.css" rel="stylesheet" />
    <link href="~/Areas/Admin/Content/css/bootstrap-datepicker3.min.css" rel="stylesheet" />

}

@section style2{

    <style>
        table thead th {
            text-align: center;
        }

        table tfoot th {
            text-align: center;
        }

        table tbody tr td {
            text-align: center;
        }
    </style>

}

<!-- BEGIN PAGE HEADER-->
<!-- BEGIN PAGE TITLE-->
<h1 class="page-title">
    Sisteme Kayıtlı Yemek Listesi
    <small>Yemekler</small>
</h1>
<!-- END PAGE TITLE-->
<!-- END PAGE HEADER-->
<div class="note note-info">
    <p> Bu sayfada sisteme kayıt edilmiş tüm yemekler listelenmektedir. </p>
</div>

@Html.Partial("_messages")

<div class="row">
    <div class="col-md-12">

        <div class="portlet light bordered">
            <div class="portlet-title">
                <div class="caption font-green">
                    <i class="icon-list font-green"></i>
                    <span class="caption-subject bold uppercase">Yemek Listesi</span>
                </div>
                <div class="tools"> </div>
            </div>
            <div class="portlet-body">
                <table class="table table-striped table-bordered table-hover" id="sample_1">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Ad</th>
                            <th>Slug</th>
                            <th>Hazırlama Zamanı</th>
                            <th>Pişirme Zamanı</th>
                            <th>Kişi</th>
                            <th>Ekleyen</th>
                            <th>Durum</th>
                            <th>Eklene Tarihi</th>
                            <th>Güncelleme Tarihi</th>
                            <th>İşlem</th>
                        </tr>
                    </thead>
                    <tfoot>
                        <tr>
                            <th>ID</th>
                            <th>Ad</th>
                            <th>Slug</th>
                            <th>Hazırlama Süre</th>
                            <th>Pişirme Süre</th>
                            <th>Kişi</th>
                            <th>Ekleyen</th>
                            <th>Durum</th>
                            <th>Eklene Tarihi</th>
                            <th>Güncelleme Tarihi</th>
                            <th>İşlem</th>
                        </tr>
                    </tfoot>
                    <tbody>
                        @foreach (var item in Model)
                        {
                            <tr>
                                <td>@item.ID</td>
                                <td>@item.Name</td>
                                <td>@item.Slug</td>
                                <td>@item.PreparationTime @item.PreparationTimeUnitOf</td>
                                <td>@item.CookingTime @item.CookingTimeUnitOf</td>
                                <td>@item.Person</td>
                                <td>@item.AppUser.UserName</td>
                                <td>
                                    @if (item.Status == TarifDefterim.Core.Enum.Status.Active)
                                    {
                                        <span class="label label-success">@item.Status</span>
                                    }
                                    else
                                    {
                                        <span class="label label-warning">@item.Status</span>
                                    }
                                </td>
                                <td>@item.CreatedDate</td>
                                <td>@item.ModifiedDate</td>
                                <td>
                                    <a href="#modal" onclick="CheckRecipe('@item.ID')" data-toggle="modal" class="btn btn-sm blue btn-outline" id="Modify">Tarif Düzenle</a>
                                    <a href="/Admin/Meal/UpdateMeal/@item.ID" class="btn btn-sm green btn-outline">Güncelle</a>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>

    </div>
</div>

<div id="modal" class="modal fade" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                <h4 class="modal-title">Tarif Düzenleme</h4>
            </div>
            <div class="modal-body">
                <div class="scroller" style="height:300px" data-always-visible="1" data-rail-visible1="1">
                    <div class="row">
                        <div class="col-md-12">
                            <p>
                                <span id="message" style="display:none"></span>
                            </p>
                            <div id="dynamicRecipeContent">
                                
                            </div>                            
                        </div>                        
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <a href="javascript:;" onclick="AddNewStep()" class="btn yellow btn-outline">Adım ekle</a>
                <button type="button" data-dismiss="modal" class="btn blue btn-outline">Kapat</button>
                <a href="javascript:;" onclick="SendRecipe()" class="btn green btn-outline">kaydet</a>
            </div>
        </div>
    </div>
</div>

@section scripts{

    <script src="~/Areas/Admin/Content/js/datatable.min.js"></script>
    <script src="~/Areas/Admin/Content/js/datatables.min.js"></script>
    <script src="~/Areas/Admin/Content/js/datatables.bootstrap.js"></script>
    <script src="~/Areas/Admin/Content/js/bootstrap-datepicker.min.js"></script>

}

@section scripts2{

    <script src="~/Areas/Admin/Content/js/table-datatables-buttons.min.js"></script>

}

@section scripts3{
        
    <script>
        var mealID;
        function CheckRecipe(val) {

            mealID = val;
            console.log(mealID);

            $.ajax({

                type: "POST",
                dataType: "Json",
                url: "@Url.Action("GetRecipe", "Recipe")/" + mealID,
                success: function (data) {
                    if (!data) {
                        $("#dynamicRecipeContent").html("");
                        $("#message").removeAttr("style");
                        $("#message").text("Seçilen yemeğin bir tarifi bulunmamaktadır. Tarif adım ekleyiniz.");
                        $("#message").addClass("note note-danger");
                    }
                    else {

                        $("#dynamicRecipeContent").html("");
                        var count = Object.keys(data).length;
                        $("#message").text("Seçilen yemeğin tarifi.");

                        if (count > 0) {

                            $.each(data, function (key, item) {

                                $("#dynamicRecipeContent").append(
                                    "<p>" + item.mealID + "</p>"+
                                    "<p>" + item.Description + "</p>" +
                                    "<p>" + item.Alignment + "</p>"
                                );

                            });

                        }

                    }
                }

            })
        }

        function SendRecipe() {

            console.log(mealID + " bilgisini tariflere göndermeye çalışıyorum.");

            $.ajax({

                type: "POST",
                dataType: "Json",
                url: "@Url.Action("AddRecipeFromList", "Recipe")/" + mealID,
                success: function (data) {
                    console.log(data);
                }

            })

        }

        var counter = 1;

        function AddNewStep() {
            $("#dynamicRecipeContent").append(
                "<p id='" + "row" + counter + "'>Tarifin adımını giriniz: <input type='text' name='Description' class='form-control' id='Description' placeholder='Adım giriniz' required />Kaçıncı adım?<select class='form-control' id='Alignment' name='Alignment' required><option value='-1'>Seçiniz</option>@for(int i = 1; i <= 100; i++){<option value='@i'>@i</option>}</select><br><button type='button' class='btn red btn-outline' onclick ='DisposeNewStep(row" + counter + ")'>Adımı Sil</button></p>"
            );
            counter++;
        }

        function DisposeNewStep(element) {
            console.log(element);
            $(element).remove();
            counter--;
        }

    </script>
    
}



